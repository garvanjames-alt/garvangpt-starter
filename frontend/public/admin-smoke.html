<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Admin Smoke Test</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; padding: 16px; line-height: 1.4; }
      button { padding: 10px 14px; margin: 6px 8px 6px 0; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; }
      pre { background: #f6f8fa; padding: 12px; border-radius: 8px; overflow-x: auto; }
      code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    </style>
  </head>
  <body>
    <h1>Admin Smoke Test</h1>
    <p>This page calls your backend with <code>credentials: "include"</code>.</p>

    <label>
      Backend base URL:
      <input id="api" size="60" />
    </label>

    <div style="margin: 10px 0 16px;">
      <button id="login">1) Login</button>
      <button id="ping">2) Ping</button>
      <button id="memGet">3) Memory GET</button>
      <button id="memPost">4) Memory POST</button>
      <button id="respond">5) Respond</button>
    </div>

    <pre id="out">Waitingâ€¦</pre>

    <script>
      // 1) Put your BACKEND URL here by default:
      const DEFAULT_API = "https://almosthuman-starter-staging.onrender.com";
      const apiInput = document.getElementById("api");
      apiInput.value = DEFAULT_API;

      const out = document.getElementById("out");
      const show = (label, data) => { out.textContent = label + ":\n" + JSON.stringify(data, null, 2); };

      async function call(path, opts={}) {
        const base = apiInput.value.replace(/\/$/, "");
        const res = await fetch(base + path, {
          method: "GET",
          credentials: "include",
          ...opts,
          headers: { "content-type": "application/json", ...(opts.headers || {}) },
        });
        const json = await res.json().catch(() => ({}));
        return { status: res.status, json };
      }

      document.getElementById("login").onclick = async () => {
        const body = { username: "garvan", password: "YOUR_PLAIN_PASSWORD_HERE" };
        const r = await call("/api/login", { method: "POST", body: JSON.stringify(body) });
        show("LOGIN", r);
      };

      document.getElementById("ping").onclick = async () => {
        const r = await call("/api/admin/ping");
        show("PING", r);
      };

      document.getElementById("memGet").onclick = async () => {
        const r = await call("/api/memory");
        show("MEM GET", r);
      };

      document.getElementById("memPost").onclick = async () => {
        const r = await call("/api/memory", { method: "POST", body: JSON.stringify({ text: "added via admin-smoke.html" }) });
        show("MEM POST", r);
      };

      document.getElementById("respond").onclick = async () => {
        const r = await call("/api/respond", { method: "POST", body: JSON.stringify({ input: "Say hello from staging and tell me the environment." }) });
        show("RESPOND", r);
      };
    </script>
  </body>
</html>
